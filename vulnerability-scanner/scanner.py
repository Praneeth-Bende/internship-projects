import nmap
import socket
import platform
import os

def scan_ports(target):
    print(f"[+] Scanning ports on {target} ...")
    scanner = nmap.PortScanner()
    scanner.scan(target, arguments='-sV')

    report = f"Target: {target}\n"
    for host in scanner.all_hosts():
        for proto in scanner[host].all_protocols():
            ports = scanner[host][proto].keys()
            for port in ports:
                service = scanner[host][proto][port]['name']
                product = scanner[host][proto][port].get('product', '')
                report += f"Port {port}/{proto} - {service} {product}\n"
    return report

def system_info():
    return f"""
System Info:
OS: {platform.system()}
Release: {platform.release()}
Hostname: {socket.gethostname()}
Local IP: {socket.gethostbyname(socket.gethostname())}
"""

def write_report(content):
    with open("report.txt", "w") as file:
        file.write(content)
    print("\n[âœ“] Report saved to report.txt")

if __name__ == "__main__":
    target = "127.0.0.1"
    info = system_info()
    port_results = scan_ports(target)
    final_report = info + "\n" + port_results
    write_report(final_report)
